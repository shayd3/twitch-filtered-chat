"use strict";var _slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}/* Twitch Filtered Chat Commands */var ChatCommandManager=function(){function a(){_classCallCheck(this,a),this._command_list=[],this._commands={},this._aliases={},this._help_text=[],this.add("help",this.command_help.bind(this),"Show help for a specific command or all commands"),this.addAlias("?","help"),this.addAlias("","help"),this.addUsage("help",null,"Show help for all commands"),this.addUsage("help","command","Show usage information for <command>")}return _createClass(a,[{key:"_trim",value:function b(a){return a.replace(/^\/\//,"").replace(/^\./,"")}},{key:"add",value:function h(a,b,d){if(!a.match(/^[a-z0-9_-]+$/))Util.Error("Invalid command \""+a.escape()+"\"");else{for(var e={name:a,func:b,desc:d},c=arguments.length,f=Array(3<c?c-3:0),g=3;g<c;g++)f[g-3]=arguments[g];e.dflt_args=0<f.length?f:null,this._command_list.push(a),this._commands[a]=e}}},{key:"addAlias",value:function c(a,b){this._aliases[a]=b}},{key:"addUsage",value:function f(a,b,d){var e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;if(this.hasCommand(a,!0)){var g=this.getCommand(a);g.usage||(g.usage=[]),g.usage.push({args:b,usage:d,opts:e||{}})}else Util.Error("Invalid command: "+a)}},{key:"addHelp",value:function g(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=b||{},d=a;if(c.literal||(d=this.formatArgs(d)),c.indent&&(d="&nbsp;&nbsp;"+d),c.command){var e=d.substr(0,d.indexOf(":")),f=d.substr(d.indexOf(":")+1);d=this.helpLine(e,f)}this._help_text.push(d)}},{key:"isCommandStr",value:function b(a){return a.match(/^\/\//)||a.match(/^\./)}},{key:"hasCommand",value:function d(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],c=this._trim(a);return!!this._commands.hasOwnProperty(c)||!b&&this._aliases.hasOwnProperty(c)}},{key:"execute",value:function e(a,b){if(this.isCommandStr(a)){var f=this._trim(a.split(" ")[0]);if(this.hasCommand(f)){var g=a.replace(/[\s]*$/,"").split(" ").slice(1);try{var d=this.getCommand(f),c=Object.create(this);c.formatUsage=this.formatUsage.bind(this,d),c.printUsage=this.printUsage.bind(this,d),c.formatHelp=this.formatHelp.bind(this,d),c.printHelp=this.printHelp.bind(this,d),c.command=f,c.cmd_func=d.func,c.cmd_desc=d.desc,d.dflt_args?d.func.bind(c).apply(void 0,[f,g,b].concat(_toConsumableArray(d.dflt_args))):d.func.bind(c)(f,g,b)}catch(a){Content.addError(f+": "+a.name+": "+a.message),Util.Error(a)}}else Content.addError(f+": unknown command")}else Content.addError(JSON.stringify(a)+": not a command string")}},{key:"getCommands",value:function a(){return Object.keys(this._commands)}},{key:"getCommand",value:function f(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],d=this._trim(a),e=this._commands[d];return e||b||!this._commands[this._aliases[d]]||(e=this._commands[this._aliases[d]]),e}},{key:"formatHelp",value:function b(a){return this.helpLine("//"+a.name,a.desc,!0)}},{key:"formatUsage",value:function k(a){var b=this,c=[];if(a.usage){var d=function(d){var e=function(c){return"&lt;"+b.arg(c)+"&gt;"};d.opts.literal&&(e=function(b){return b});var f="",g=b.formatArgs(d.usage);Util.IsArray(d.args)?(f=d.args.map(function(b){return e(b)}).join(" "),c.push(b.helpLine("//"+a.name+" "+f,g))):d.args?(f=e(d.args),c.push(b.helpLine("//"+a.name+" "+f,g))):c.push(b.helpLine("//"+a.name,g))},e=!0,f=!1,g=void 0;try{for(var h,d,j=a.usage[Symbol.iterator]();!(e=(h=j.next()).done);e=!0)i=h.value,d(d)}catch(a){f=!0,g=a}finally{try{!e&&j.return&&j.return()}finally{if(f)throw g}}}else c.push(this.helpLine("//"+a.name,this.formatArgs(a.desc)));return c}/* Built-in //help command */},{key:"command_help",value:function w(a,b){if(0===b.length){Content.addHelp("Commands:");var d=!0,e=!1,f=void 0;try{for(var g,h,i=Object.values(this._command_list)[Symbol.iterator]();!(d=(g=i.next()).done);d=!0)h=g.value,Content.addHelp(this.formatHelp(this._commands[h]))}catch(a){e=!0,f=a}finally{try{!d&&i.return&&i.return()}finally{if(e)throw f}}Content.addHelp(this.formatArgs("Enter //help <command> for help on <command>"));var j=!0,k=!1,l=void 0;try{for(var m,n,o=this._help_text[Symbol.iterator]();!(j=(m=o.next()).done);j=!0)n=m.value,Content.addHelp(n)}catch(a){k=!0,l=a}finally{try{!j&&o.return&&o.return()}finally{if(k)throw l}}}else if(this.hasCommand(b[0])){Content.addHelp("Commands:");var p=this.getCommand(b[0]),q=!0,r=!1,s=void 0;try{for(var t,u,v=this.formatUsage(p)[Symbol.iterator]();!(q=(t=v.next()).done);q=!0)u=t.value,Content.addHelp(u)}catch(a){r=!0,s=a}finally{try{!q&&v.return&&v.return()}finally{if(r)throw s}}}else Content.addError("Invalid command "+b[0].escape())}},{key:"arg",value:function b(a){return"<span class=\"arg\">"+a.escape()+"</span>"}},{key:"helpLine",value:function f(a,b){var c=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],d="<div>"+(c?a.escape():a)+"</div>",e="<div>"+(c?b.escape():b)+"</div>";return"<div class=\"helpline\">"+d+e+"</div>"}},{key:"formatArgs",value:function c(a){var b=this;return a.replace(/<([^>]+)>/g,function(a,c){return"&lt;"+b.arg(c)+"&gt;"})}},{key:"printUsage",value:function h(a){Content.addHelp("Usage:");var b=!0,c=!1,d=void 0;try{for(var e,f,g=this.formatUsage(a)[Symbol.iterator]();!(b=(e=g.next()).done);b=!0)f=e.value,Content.addHelp(f)}catch(a){c=!0,d=a}finally{try{!b&&g.return&&g.return()}finally{if(c)throw d}}}},{key:"printHelp",value:function b(a){Content.addHelp(this.formatHelp(a))}}]),a}();function command_log(a,c){var d=Math.floor,e=Util.GetWebStorage("debug-msg-log")||[];if(Content.addHelp("Debug message log length: "+e.length),!(0<c.length))this.printUsage();else if("help"===c[0])this.printHelp(),this.printUsage();else if("show"===c[0]){var f=!0,g=!1,h=void 0;try{for(var j,k=Object.entries(e)[Symbol.iterator]();!(f=(j=k.next()).done);f=!0){var m=j.value,n=_slicedToArray(m,2),o=n[0],i=n[1];Content.addHelp(o+": "+JSON.stringify(i).escape())}}catch(a){g=!0,h=a}finally{try{!f&&k.return&&k.return()}finally{if(g)throw h}}}else if("export"===c[0]){var l=.75*window.innerWidth,p=window.open("assets/log-export.html","TFCLogExportWindow","menubar=no,toolbar=no,location=no,status=no,resizable=yes,scrollbars=yes,dependent=yes,width="+d(l));p&&(p.onload=function(){this.addEntries(e)})}else if("summary"===c[0]){var q=[],r=[],s=!0,t=!1,u=void 0;try{for(var v,w=Object.values(e)[Symbol.iterator]();!(s=(v=w.next()).done);s=!0){var x=v.value,y="";y=x._cmd?x._cmd:JSON.stringify(x).substr(0,10),r.push(y),10<=r.length&&(q.push(r),r=[])}}catch(a){t=!0,u=a}finally{try{!s&&w.return&&w.return()}finally{if(t)throw u}}0<r.length&&q.push(r);var z=0,A=!0,B=!1,C=void 0;try{for(var D,E,F=Object.values(q)[Symbol.iterator]();!(A=(D=F.next()).done);A=!0)E=D.value,Content.addHelp(z+"-"+(z+E.length-1)+": "+JSON.stringify(E)),z+=E.length}catch(a){B=!0,C=a}finally{try{!A&&F.return&&F.return()}finally{if(B)throw C}}}else if("shift"===c[0])e.shift(),Content.addHelp("New logs length: "+e.length),Util.SetWebStorage("debug-msg-log",e);else if("pop"===c[0])e.pop(),Content.addHelp("New logs length: "+e.length),Util.SetWebStorage("debug-msg-log",e);else if("size"===c[0]){var G=JSON.stringify(e).length;Content.addHelp("Logged bytes: "+G+" ("+G/1024+" KB)")}else if("clear"===c[0])Util.SetWebStorage("debug-msg-log",[]),Content.addHelp("Log cleared");else if(c[0].match(/^[1-9][0-9]*$/)){var b=+c[0];Content.addHelp(JSON.stringify(e[b]).escape())}else Content.addHelp("Unknown argument "+c[0])}function command_clear(a,b){0===b.length?$(".content").find(".line-wrapper").remove():"module1"===b[0]?$("#module1").find(".line-wrapper").remove():"module2"===b[0]?$("#module2").find(".line-wrapper").remove():this.printUsage()}function command_join(a,b,c){0<b.length?c.JoinChannel(b[0]):this.printUsage()}function command_part(a,b,c){0<b.length?c.LeaveChannel(b[0]):this.printUsage()}function command_badges(a,b,c){var d=[],e=!0,f=!1,g=void 0;/* Obtain global badges */try{for(var h,i=Object.entries(c.GetGlobalBadges())[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value,k=_slicedToArray(j,2),l=k[0],m=k[1],n=!0,o=!1,p=void 0;try{for(var q,r=Object.values(m.versions)[Symbol.iterator]();!(n=(q=r.next()).done);n=!0){var s=q.value,t=s.image_url_2x,u=36;-1<b.indexOf("small")?(t=s.image_url_1x,u=18):-1<b.indexOf("large")&&(t=s.image_url_4x,u=72);var L="width=\""+u+"\" height=\""+u+"\" title=\""+l+"\"";d.push("<img src=\""+t+"\" "+L+" alt=\""+l+"\" />")}}catch(a){o=!0,p=a}finally{try{!n&&r.return&&r.return()}finally{if(o)throw p}}}/* Print global badges */}catch(a){f=!0,g=a}finally{try{!e&&i.return&&i.return()}finally{if(f)throw g}}Content.addNotice(d.join(""));/* Obtain channel badges */var v=!0,w=!1,x=void 0;try{for(var y,z,A=c.GetJoinedChannels()[Symbol.iterator]();!(v=(y=A.next()).done);v=!0){z=y.value,d=[];var B=!0,C=!1,D=void 0;try{for(var E,F=Object.entries(c.GetChannelBadges(z))[Symbol.iterator]();!(B=(E=F.next()).done);B=!0){var G=E.value,H=_slicedToArray(G,2),I=H[0],J=H[1],K=J.image||J.svg||J.alpha;d.push("<img src=\""+K+"\" width=\"36\" height=\"36\" title=\""+I+"\" alt=\""+I+"\" />")}/* Print channel badges */}catch(a){C=!0,D=a}finally{try{!B&&F.return&&F.return()}finally{if(C)throw D}}Content.addNotice(Twitch.FormatChannel(z)+": "+d.join(""))}}catch(a){w=!0,x=a}finally{try{!v&&A.return&&A.return()}finally{if(w)throw x}}}function command_emotes(a,b,c){var d=c.GetEmotes(),f=[],g=[],h=!0,i=!1,j=void 0;try{for(var l,m=Object.entries(d)[Symbol.iterator]();!(h=(l=m.next()).done);h=!0){var n=l.value,o=_slicedToArray(n,2),p=o[0],k=o[1],q="<img src=\""+k+"\" title=\""+p.escape()+"\" alt=\""+p.escape()+"\" />";p.match(/^[a-z]/)?g.push(q):f.push(q)}}catch(a){i=!0,j=a}finally{try{!h&&m.return&&m.return()}finally{if(i)throw j}}var e=[];if(-1<b.indexOf("global")&&e.push("Global: "+f.join("")),-1<b.indexOf("channel")&&e.push("Channel: "+g.join("")),-1<b.indexOf("bttv")){var r=c.GetGlobalBTTVEmotes(),s=[],t=!0,u=!1,v=void 0;try{for(var w,x=Object.entries(r)[Symbol.iterator]();!(t=(w=x.next()).done);t=!0){var y=w.value,z=_slicedToArray(y,2),A=z[0],B=z[1];s.push("<img src=\""+B.url+"\" title=\""+A.escape()+"\" alt=\""+A.escape()+"\" />")}}catch(a){u=!0,v=a}finally{try{!t&&x.return&&x.return()}finally{if(u)throw v}}e.push("BTTV: "+s.join(""))}if(0===e.length)this.printHelp(),this.printUsage();else{var C=!0,D=!1,E=void 0;try{for(var F,G,H=e[Symbol.iterator]();!(C=(F=H.next()).done);C=!0)G=F.value,Content.addNotice(G)}catch(a){D=!0,E=a}finally{try{!C&&H.return&&H.return()}finally{if(D)throw E}}}}function command_plugins(){try{var a=!0,b=!1,c=void 0;try{for(var d,e=Object.entries(Plugins.plugins)[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value,g=_slicedToArray(f,2),h=g[0],i=g[1],j=h+": "+i.file+" @ "+i.order;i._error?Content.addError(j+": Failed: "+JSON.stringify(i._error_obj)):i._loaded&&(j+=": Loaded",i.commands&&(j=j+": Commands: "+i.commands.join(" ")),Content.addPre(j))}}catch(a){b=!0,c=a}finally{try{!a&&e.return&&e.return()}finally{if(b)throw c}}}catch(a){if("ReferenceError"===a.name)Content.addError("Plugin information unavailable");else throw a}}function command_client(a,b,d){if(0===b.length||"status"===b[0]){Content.addHelp("Client information:");var p=d.ConnectionStatus();Content.addHelpLine("Socket:",p.open?"Open":"Closed"),Content.addHelpLine("Status:",p.connected?"Connected":"Not connected"),Content.addHelpLine("Identified:",p.identified?"Yes":"No"),Content.addHelpLine("Authenticated:",p.authed?"Yes":"No"),Content.addHelpLine("Name:",d.GetName()),Content.addHelpLine("FFZ:",d.FFZEnabled()?"Enabled":"Disabled"),Content.addHelpLine("BTTV:",d.BTTVEnabled()?"Enabled":"Disabled");var e=d.GetJoinedChannels(),f=d.SelfUserState()||{};if(e&&0<e.length){Content.addHelp("&gt; Channels connected to: "+e.length);var g=!0,h=!1,i=void 0;try{for(var j,k=e[Symbol.iterator]();!(g=(j=k.next()).done);g=!0){var l=j.value,c=d.GetChannelInfo(l),m=c&&c.users?c.users.length:0,n=c.rooms||{},o=(c.online?"":"not ")+"online";Content.addHelpLine(l,"Status: "+o+("; id="+c.id)),Content.addHelpLine("&nbsp;","Active users: "+m),Content.addHelpLine("&nbsp;","Rooms: "+Object.keys(n));var q=f[l];Content.addHelp("User information for "+l+":"),q.color&&Content.addHelpLine("Color",q.color),q.badges&&Content.addHelpLine("Badges",JSON.stringify(q.badges)),Content.addHelpLine("Name",""+q["display-name"])}}catch(a){h=!0,i=a}finally{try{!g&&k.return&&k.return()}finally{if(h)throw i}}}Content.addHelpLine("User ID",""+f.userid)}else this.printUsage()}function command_raw(a,b,c){c.SendRaw(b.join(" "))}/* Default command definition
 * Structure:
 *  <name>: {
 *    func: <function>,
 *    desc: description of the command (used by //help)
 *    alias: array of command aliases (optional)
 *    usage: array of usage objects:
 *      [0]: string, array, or null: parameter name(s)
 *      [1]: description
 *      [2]: options (optional)
 *  }
 */var DefaultCommands={log:{func:command_log,desc:"Display logged messages",alias:["logs"],usage:[[null,"Display log command usage"],["number","Display the message numbered <number>"],["show","Display all logged messages (can be a lot of text!)",{literal:!0}],["summary","Display a summary of the logged messages",{literal:!0}],["shift","Remove the first logged message",{literal:!0}],["pop","Remove the last logged message",{literal:!0}],["export","Open a new window with all the logged items",{literal:!0}],["size","Display the number of bytes used by the log",{literal:!0}],["clear","Clears the entire log (cannot be undone!)",{literal:!0}]]},clear:{func:command_clear,desc:"Clears all text from either all modules or the specified module",alias:["nuke"],usage:[[null,"Clears all text from all visible modules"],["module1","Clears all text from module1",{literal:!0}],["module2","Clears all text from module2",{literal:!0}]]},join:{func:command_join,desc:"Join a channel",alias:["j"],usage:[["Channel","Connect to <channel>; leading # is optional"]]},part:{func:command_part,desc:"Leave a channel",alias:["leave"],usage:[["channel","Disconnect from <channel>; leading # is optional"]]},badges:{func:command_badges,desc:"Display all known badges"},emotes:{func:command_emotes,desc:"Display the requested emotes",usage:[["kinds","Display emotes; <kinds> can be one or more of: global, channel, bttv"]]},plugins:{func:command_plugins,desc:"Display plugin information, if plugins are enabled"},client:{func:command_client,desc:"Display numerous things about the client; use //help client for info",usage:[[null,"Show general information about the client"],["status","Show current connection information",{literal:!0}]]},raw:{func:command_raw,desc:"Send a raw message to Twitch (for advanced users only!)",usage:[["message","Send <message> to Twitch servers (for advanced users only!)"]]}},ChatCommands=null;function InitChatCommands(){ChatCommands=new ChatCommandManager;var a=!0,b=!1,c=void 0;try{for(var d,e=Object.entries(DefaultCommands)[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value,g=_slicedToArray(f,2),h=g[0],i=g[1];if(ChatCommands.add(h,i.func,i.desc),i.usage){var j=!0,k=!1,l=void 0;try{for(var m,n,o=i.usage[Symbol.iterator]();!(j=(m=o.next()).done);j=!0)n=m.value,ChatCommands.addUsage(h,n[0],n[1],n[2])}catch(a){k=!0,l=a}finally{try{!j&&o.return&&o.return()}finally{if(k)throw l}}}if(i.alias){var p=!0,q=!1,r=void 0;try{for(var s,t,u=i.alias[Symbol.iterator]();!(p=(s=u.next()).done);p=!0)t=s.value,ChatCommands.addAlias(t,h)}catch(a){q=!0,r=a}finally{try{!p&&u.return&&u.return()}finally{if(q)throw r}}}}}catch(a){b=!0,c=a}finally{try{!a&&e.return&&e.return()}finally{if(b)throw c}}}/* vim: set ts=2 sts=2 sw=2 et: */