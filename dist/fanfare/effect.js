/* Twitch Filtered Chat Fanfare: Effects */"use strict";var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}/* 0}}} *//* exported FanfareEffect FanfareCheerEffect FanfareSubEffect *//* globals FanfareParticle */var FanfareEffect=function(){/* {{{0 */function a(b,c){_classCallCheck(this,a),this._host=b,this._config=c||{},this._particles=[],this._cb={}}return _createClass(a,[{key:"config",value:function b(a){return this._config[a]}},{key:"fire",/* Fire one of the callbacks defined above */value:function f(a){if(this._cb.hasOwnProperty(a)){for(var b,c=arguments.length,d=Array(1<c?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];(b=this._cb)[a].apply(b,d)}}/* Load the effect; returns a promise */},{key:"load",value:function a(){return new Promise(function(a,b){var c=null;/* Determine the image to use */this.emote?c=this._host.twitchEmote(this.emote):this.imageUrl&&(c=this._host.image(this.imageUrl)),c.onload=function(b){this._image=c,this.fire("load",this),this.initialize(),a(b)}.bind(this),c.onerror=function(a){Util.Error(a),b(a)}.bind(this)}.bind(this))}/* Initialize the effect */},{key:"start",value:function a(){this.initialize(),this.fire("start",this)}/* Handle particle movement */},{key:"tick",value:function h(){this.fire("tick",this);var a=0,b=!0,c=!1,d=void 0;try{for(var e,f,g=this._particles[Symbol.iterator]();!(b=(e=g.next()).done);b=!0)f=e.value,f.tick(),f.alive&&(a+=1)}catch(a){c=!0,d=a}finally{try{!b&&g.return&&g.return()}finally{if(c)throw d}}return 0==a&&(this.fire("end",this),this.fire("complete",this)),0<a}/* Draw the particles to the given context */},{key:"draw",value:function h(a){this.fire("predraw",this);var b=!0,c=!1,d=void 0;try{for(var e,f,g=this._particles[Symbol.iterator]();!(b=(e=g.next()).done);b=!0)f=e.value,f.draw(a)}catch(a){c=!0,d=a}finally{try{!b&&g.return&&g.return()}finally{if(c)throw d}}this.fire("draw",this)}},{key:"count",get:function a(){return this._particles.length}},{key:"alive",get:function a(){return this._particles.filter(function(a){return a.alive}).length}},{key:"onload",get:function a(){return this._cb.onload},set:function b(a){this._cb.onload=a}},{key:"onpredraw",get:function a(){return this._cb.onpredraw},set:function b(a){this._cb.onpredraw=a}},{key:"ondraw",get:function a(){return this._cb.ondraw},set:function b(a){this._cb.ondraw=a}},{key:"onstart",get:function a(){return this._cb.start},set:function b(a){this._cb.start=a}},{key:"onend",get:function a(){return this._cb.end},set:function b(a){this._cb.end=a}},{key:"oncomplete",get:function a(){return this._cb.complete},set:function b(a){this._cb.complete=a}}]),a}(),FanfareCheerEffect=function(a){/* {{{0 */function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return e._event=d,e._bits=d.bits||1,e}return _inherits(b,a),_createClass(b,[{key:"initialize",/* Called by base class */value:function a(){for(var b=0;b<this.num;++b)this._particles.push(new FanfareParticle({xmin:0,xmax:this._host.width-40,ymin:this._host.height-100,ymax:this._host.height-30,dxmin:0,dxmax:1,dymin:0,dymax:1,xforcemin:-.1,xforcemax:.1,yforcemin:-.5,yforcemax:0,image:this._image}))}},{key:"name",get:function a(){return"FanfareCheerEffect"}},{key:"num",get:function a(){return this.config("numparticles")?this.config("numparticles"):this._image&&this._image.width?this._host.width/this._image.width:10}},{key:"emote",get:function a(){/* null forces imageUrl to be called */return null}},{key:"imageUrl",get:function f(){if(this.config("cheerurl"))return this.config("cheerurl");if(this.config("imageurl"))return this.config("imageurl");var a="Cheer",c=null,d=null;this.config("cheermote")&&(a=this.config("cheermote")),this.config("cheerbg")&&(c=this.config("cheerbg")),this.config("cheerscale")&&(d=this.config("cheerscale"));var e=this._host._client.GetGlobalCheer(a);return b.cheerToURL(e,this._bits,c,d)}}],[{key:"cheerToURL",value:function o(a,c){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,f=d||b.background,g=e||b.scale;a.backgrounds.includes(f)||(Util.DebugOnly("Background "+f+" not in "+JSON.stringify(a.backgrounds)),f=a.backgrounds[0]),a.scales.map(function(a){return""+a}).includes(g)||(Util.DebugOnly("Scale "+g+" not in "+JSON.stringify(a.scales)),g=a.scales[0]);/* Figure out the tier we're using */var h=a.tiers[0],i=!0,j=!1,k=void 0;try{for(var l,m,n=Object.values(a.tiers)[Symbol.iterator]();!(i=(l=n.next()).done);i=!0)m=l.value,0<m.min_bits&&c>=m.min_bits&&(h=m);/* Return the derived URL */}catch(a){j=!0,k=a}finally{try{!i&&n.return&&n.return()}finally{if(j)throw k}}try{return h.images[f].static[g]}catch(a){return Util.ErrorOnly(a),Util.ErrorOnly(h,f,g),""}}},{key:"background",get:function a(){return $("body").hasClass("light")?"light":"dark"}},{key:"scale",get:function a(){return"2"}}]),b}(FanfareEffect),FanfareSubEffect=function(a){/* {{{0 */function b(a,c,d){_classCallCheck(this,b);var e=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return e._event=d,e._kind=d.kind||TwitchSubEvent.SUB,e._tier=d.plan||TwitchSubEvent.PLAN_TIER1,e}return _inherits(b,a),_createClass(b,[{key:"initialize",/* Called by base class */value:function a(){for(var b=0;b<this.num;++b)this._particles.push(new FanfareParticle({xmin:0,xmax:this._host.width-40,ymin:this._host.height-100,ymax:this._host.height-30,dxrange:[-5,5],dyrange:[-4,1],xforcemin:-.1,xforcemax:.1,yforcemin:-.5,yforcemax:0,image:this._image}))}},{key:"name",get:function a(){return"FanfareSubEffect"}},{key:"num",get:function a(){return this.config("numparticles")?this.config("numparticles"):this._image&&this._image.width?this._host.width/this._image.width:10}},{key:"emote",get:function a(){/* null forces imageUrl to be called */return null}},{key:"imageUrl",get:function c(){if(this.config("suburl"))return this.config("suburl");if(this.config("imageurl"))return this.config("imageurl");var a="HolidayPresent",b="1.0";return this.config("subemote")?a=this.config("subemote"):this._kind===TwitchSubEvent.SUB?a="MrDestructoid":this._kind===TwitchSubEvent.RESUB?a="PraiseIt":this._kind===TwitchSubEvent.GIFTSUB?a="HolidayPresent":this._kind===TwitchSubEvent.ANONGIFTSUB?a="HolidayPresent":this.config("emote")&&(a=this.config("emote")),this._tier===TwitchSubEvent.PLAN_TIER2?b="2.0":this._tier===TwitchSubEvent.PLAN_TIER3&&(b="3.0"),this._host._client.GetEmote(a,b)}}]),b}(FanfareEffect);/* 0}}} *//* 0}}} */